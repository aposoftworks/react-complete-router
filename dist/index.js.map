{"version":3,"file":"index.js","sources":["../src/contexts/Router.tsx","../src/helpers/guard.tsx","../src/guards/guest.tsx","../src/guards/logged.tsx","../src/guards/when.tsx","../src/helpers/route.tsx","../src/guards/path.tsx","../src/guards/title.tsx","../src/guards/redirect.tsx","../src/guards/index.tsx","../src/modules/Router.tsx","../src/modules/Route.tsx","../src/modules/Link.tsx","../src/modules/Switch.tsx","../src/index.tsx"],"sourcesContent":["//Core\nimport * as React       from \"react\";\n\n//Interfaces\nimport iRouterContext \tfrom \"../interfaces/contexts\";\nimport { iRoute }       from \"../interfaces/components\";\n\n//Dumb data\nconst dumbdata = {\n    data: {},\n\tcurrent:\"/\",\n\tbasepath:\"/\",\n    processRoute: (data : iRoute) : boolean | Object => !data,\n    redirect: (data : string) : void => {data;}\n};\n\nconst RouterContext = React.createContext(dumbdata as iRouterContext) as React.Context<iRouterContext>;\n\nexport default RouterContext;\n","//Contexts\r\nimport { iGuard }   from \"../contexts/helpers\";\r\n\r\n//Turn a string guard into a object\r\nexport function buildGuard (guardstring : string) : iGuard {\r\n    const split = guardstring.split(\":\");\r\n    \r\n    //No arguments\r\n    if (split.length == 1) {\r\n        return { name: split[0] };\r\n    }\r\n    else {\r\n        const _arguments = split[1].split(\",\");\r\n\r\n        return { name: split[0], arguments : _arguments };\r\n    }\r\n}\r\n\r\n//Turn a prop into a guard string\r\nexport function printGuard (props : Object) : string[] {\r\n    let response : string[] = [];\r\n\r\n    for (const key in props) {\r\n        const prop = props[key];\r\n\r\n        //has argument\r\n        if (prop !== true) {\r\n            response.push(key + \":\" + prop);\r\n        }\r\n        //without argument\r\n        else {\r\n            response.push(key);\r\n        }\r\n    }\r\n\r\n    return response;\r\n}","//Interfaces\r\nimport { iGuardData } from \"../interfaces/helpers\";\r\n\r\n//Check router authentication and only pass if none is given\r\nexport default function guest (_arguments : any[] | null, data : iGuardData) : Object | boolean {\r\n    //No auth given\r\n    if (!(\"auth\" in data.router)) return true;\r\n\r\n    //Check for guest\r\n    return !data.router[\"auth\"];\r\n}","//Interfaces\r\nimport { iGuardData } from \"../interfaces/helpers\";\r\n\r\n//Check router authentication and only pass if none is given\r\nexport default function logged (_arguments : any[] | null, data : iGuardData) : Object | boolean {\r\n    //No auth given\r\n    if (!(\"auth\" in data.router)) return false;\r\n\r\n    //Check for log\r\n    return !!data.router[\"auth\"];\r\n}","//Interfaces\r\nimport { iGuardData } from \"../interfaces/helpers\";\r\n\r\n//Check route validation\r\nexport default function when (_arguments : any[] | null, data : iGuardData) : Object | boolean {\r\n    //No when required\r\n    if (!(\"when\" in data.route)) return true;\r\n\r\n    //Validate\r\n    return !!data.route[\"when\"];\r\n}","//Test if the current path passes\nexport function testPath (current : string, path : string, exact : boolean = true, negate : boolean = false) : Object | boolean {\n    //Paths\n    const splitpath     = path.split(\"/\").filter( value => value !== \"\");\n    const splitcurrent  = current.split(\"/\").filter( value => value !== \"\");\n\n    //Data\n\tlet data    = {};\n\n    //Match root\n    if (splitpath.length == 0 && splitcurrent.length != 0 && exact) return negate;\n\n    //Loop all parts of the route\n    for (let i = 0; i < splitpath.length; i++) {\n        //Is a data compartiment\n        if (splitpath[i].match(/\\{\\S+\\}/)) {\n\t\t\tconst name \t\t= splitpath[i].replace(/\\{/, \"\").replace(/\\}/,\"\");\n\t\t\tconst optional\t= name.match(/\\?$/);\n\n\t\t\t//Add only if exists\n\t\t\tif (splitcurrent[i]) {\n\t\t\t\tdata[name] = splitcurrent[i];\n\t\t\t}\n\t\t\telse if (!optional) {\n\t\t\t\treturn negate;\n\t\t\t}\n        }\n        //Equivalent match\n        else {\n            //Current ends earlier\n            if (!splitcurrent[i]) return negate;\n            //Part matches\n            if (splitpath[i] !== splitcurrent[i]) return negate;\n        }\n\t}\n\n\t//Check extra\n\tif (splitpath.length < splitcurrent.length && exact) return negate;\n\n    //Route matches\n    return negate? false:data;\n}\n","//Interfaces\nimport { iGuardData }   from \"../interfaces/helpers\";\n\n//Helpers\nimport { testPath }     from \"../helpers/route\";\n\n//Check route validation path\nexport default function path (_arguments : any[] | null, data : iGuardData) : Object | boolean {\n    //No path required\n    if (!(\"path\" in data.route)) return true;\n\n\t//Is exact match\n\tconst negate\t= data.route[\"negate\"]?data.route[\"negate\"]:false;\n\tconst exact \t= data.route[\"exact\"]? data.route[\"exact\"]:false;\n\tconst current \t= \"/\" + (data.context[\"basepath\"] as string).replace(/(^\\/|\\/$)/, \"\") + \"/\" + (data.context[\"current\"] as string).replace(/^\\//, \"\");\n\n    //Validate\n    return testPath(current, data.route[\"path\"] as string, exact as boolean, negate as boolean);\n}\n","//Interfaces\nimport { iGuardData } from \"../interfaces/helpers\";\n\n//When this route is applied, it will insert the title into the browser\n//Be careful to not stack this guard, since one will override another\nexport default function title (_arguments : any[] | null, data : iGuardData) : Object | boolean {\n    const basetitle \t\t= data.router[\"basetitle\"];\n\tconst subtitle  \t\t= data.route[\"title\"];\n\tconst basetitlestring \t= Array.isArray(basetitle) ? basetitle[0]:basetitle;\n\tconst midtitlestring\t= Array.isArray(basetitle) ? basetitle[1]:\"-\";\n\n    //Update page title\n    if (basetitle && subtitle)  document.title = basetitlestring + \" \" + midtitlestring + \" \" + subtitle;\n    else if (basetitle)         document.title = basetitlestring;\n    else                        document.title = subtitle;\n\n    //No need of blocking\n    return true;\n}\n","//Interfaces\nimport { iGuardData } from \"../interfaces/helpers\";\n\n//Redirect the route if it matches\nexport default function redirect (_arguments : any[] | null, data : iGuardData) : Object | boolean {\n\t//Place to redirect\n\tdata.context[\"redirect\"](data.route[\"redirect\"]);\n\n\treturn true;\n}\n","//Guard functions\nimport _guest   \tfrom \"./guest\";\nimport _logged  \tfrom \"./logged\";\nimport _when    \tfrom \"./when\";\nimport _path    \tfrom \"./path\";\nimport _title   \tfrom \"./title\";\nimport _redirect\tfrom \"./redirect\";\n\n//Separated export\nexport const guest  \t= _guest;\nexport const logged \t= _logged;\nexport const when   \t= _when;\nexport const path   \t= _path;\nexport const title  \t= _title;\nexport const redirect\t= _redirect;\n\n//Bundle of default guards\nconst bundle = {\n    guest:  \t_guest,\n    logged: \t_logged,\n    when:   \t_when,\n    path:   \t_path,\n\ttitle:  \t_title,\n\tredirect: \t_redirect,\n};\n\nexport default bundle;\n","//Core\nimport * as React \t    from \"react\";\n\n//Contexts\nimport RouterContext    from \"../contexts/Router\";\n\n//Interfaces\nimport { iRoute }   from \"../interfaces/components\";\n\n//Guards\nimport { buildGuard, printGuard }   from \"../helpers/guard\";\nimport defaultBundle                from \"../guards\";\n\nexport default function Router ({basepath = \"/\", guards = {}, sticky = false, ...props}) {\n\n    //----------------------------\n    // Properties\n    //----------------------------\n\n    //states\n    const [ current, setcurrent ]   = React.useState(window.location.pathname);\n\tconst [ readyguards ]           = React.useState({...defaultBundle, ...guards});\n\tconst [ history, sethistory ]\t= React.useState<string[]>([]);\n\n    //----------------------------\n    // Callbacks\n\t//----------------------------\n\n\tconst onSetCurrent = React.useCallback((newcurrent : string) => {\n\t\tconst base \t\t= basepath.replace(/\\/$/, \"\");\n\t\tconst target \t= newcurrent.replace(/(^\\/|\\/$)/, \"\");\n\n\t\tif (base == \"\" && target == \"\")\n\t\t\tsetcurrent(\"/\");\n\t\telse\n\t\t\tsetcurrent(base + (target === \"\" ? \"\":(\"/\" + target)));\n\t}, [setcurrent]);\n\n\tconst onProcessMimic = React.useCallback((_guard : string, data : Object = {}) : Object | boolean => {\n\t\t//Build guard\n\t\tconst guard = buildGuard(_guard);\n\n\t\t//Guard available\n\t\tif (guard.name in readyguards) {\n\t\t\treturn readyguards[guard.name](guard.arguments, {data, router: props, context});\n\t\t}\n\n\t\t//No guard available\n\t\treturn false;\n\t}, [props, readyguards, current]);\n\n    const onProcessRoute = React.useCallback((data : iRoute) : Object | boolean => {\n        //Remove reserved props\n        const { to, guard, ...clearedProps } = data;\n\n        //Check priority guards\n        const prioritydata = onProcessGuard(guard, data);\n        if (!prioritydata) return false;\n\n        //Check non priority guards\n        const nonprioritydata = onProcessGuard(printGuard(clearedProps), data, false);\n        if (!nonprioritydata) return false;\n\n        //Route matches\n        return {...(prioritydata as Object),...(nonprioritydata as Object)};\n    }, [current, props]);\n\n    const onProcessGuard = React.useCallback((guards : string[]|string|undefined, route : iRoute, priority : boolean = true) : Object | boolean => {\n        //Props that will be filled to the route by the end of the process\n        let data = {};\n\n        //Guard check not necessary\n        if (guards === undefined) return true;\n\n        //Validate guards\n        const _guards : string[] = Array.isArray(guards)? (guards as string[]):[guards as string];\n\n        //Loop guards\n        for (let i = 0; i < _guards.length;i++) {\n            //Build guard\n            const guard = buildGuard(_guards[i]);\n\n            //Guard available\n            if (guard.name in readyguards) {\n                const response = readyguards[guard.name](guard.arguments, {route, router: props, context});\n\n                //Guard fail\n                if (!response) return false;\n\n                //Fill data\n                if (typeof response === \"object\") data = {...data, ...response};\n            }\n            else if (priority) {\n                console.warn(\"Requested guard [\" + _guards[i] + \"] was not found.\");\n            }\n        }\n\n        //All guards passes\n        return data;\n    }, [current, props]);\n\n    const handleHash = React.useCallback((event) => {\n        //Prevent page reload\n\t\tevent.preventDefault();\n\n\t\tconst path = window.location.pathname.replace(/(^\\/|\\/$)/, \"\");\n\n        if (\"/\" + path != current) {\n            onSetCurrent(window.location.pathname);\n        }\n\t}, [current]);\n\n\tconst onProcessBack = React.useCallback(() => {\n\t\tlet _history \t= history;\n\t\tlet path \t\t= _history.pop();\n\n\t\tsethistory(_history);\n\t\tonSetCurrent(path || \"/\");\n\t}, [current, history]);\n\n    //----------------------------\n    // Effects\n    //----------------------------\n\n    //Event binding\n    React.useEffect(() => {\n        window.addEventListener(\"popstate\", handleHash, false);\n\n        //Unbind\n        return () => {\n            document.removeEventListener(\"hashchange\", handleHash, false);\n        };\n    }, [current]);\n\n    React.useEffect(() : void => {\n\t\tif (\"/\" + window.location.pathname.replace(/(^\\/|\\/$)/, \"\") != current) {\n\t\t\t//Update browser\n\t\t\tif (!sticky)\n\t\t\twindow.history.pushState(\"\", window.document.title, current);\n\n\t\t\t//Update internal history\n\t\t\tlet _history = history;\n\t\t\t_history.push(current);\n\t\t\tsethistory(_history);\n        }\n    }, [current]);\n\n    //----------------------------\n    // Render\n    //----------------------------\n\n    const context = {\n        current:            current,\n        processRoute:       onProcessRoute,\n        processGuard:       onProcessGuard,\n        redirect:           onSetCurrent,\n\t\tdata:               props,\n\t\tmimic:\t\t\t\tonProcessMimic,\n\t\tback: \t\t\t\tonProcessBack,\n\t\tbasepath:\t\t\tbasepath,\n    };\n\n    return (\n        <RouterContext.Provider value={context}>\n            {props.children}\n        </RouterContext.Provider>\n    );\n}\n","//Core\nimport * as React \t    from \"react\";\n\n//Contexts\nimport RouterContext    from \"../contexts/Router\";\nimport iRouterContext   from \"../interfaces/contexts\";\n\n//Interfaces\nimport { iRoute } \t\tfrom \"../interfaces/components\";\nimport { iReactProps }\tfrom \"../interfaces/iReact\";\n\nexport default function Route ({children, to = () => null, ...props} : iReactProps) {\n\n    //----------------------------\n    // Properties\n    //----------------------------\n\n    //contexts\n    const { processRoute, current, data }  = React.useContext(RouterContext) as iRouterContext;\n\n    //----------------------------\n    // Memos\n    //----------------------------\n\n    const Component = React.useCallback(() : JSX.Element | null => {\n        const response = processRoute(props as iRoute);\n\n        if (response) {\n\t\t\t//Route passes to prop to\n\t\t\tif (to !== null) {\n\t\t\t\treturn React.createElement(to, {...props, ...(response as Object)});\n\t\t\t}\n\t\t\t//Route passes to children\n\t\t\tif (children !== null) {\n\t\t\t\treturn React.createElement(children, {...props, ...(response as Object)});\n\t\t\t}\n\t\t}\n\n        //Route not passes\n        return null;\n    }, [current, data]);\n\n    //----------------------------\n    // Render\n    //----------------------------\n\n    return <Component />;\n}\n","//Core\nimport * as React \tfrom \"react\";\n\n//Contexts\nimport RouterContext from \"../contexts/Router\";\n\n//Interfaces\nimport iRouterContext from \"../interfaces/contexts\";\n\nexport default function Link ({to = \"/\", ...props}) {\n\n    //----------------------------\n    // Properties\n    //----------------------------\n\n    //contexts\n    const { redirect, current } = React.useContext(RouterContext) as iRouterContext;\n\n    //----------------------------\n    // Memos\n\t//----------------------------\n\n\tconst targetMemo = React.useMemo(() => {\n\t\treturn \"/\" + to.replace(/(^\\/|\\/$)/, \"\");\n\t},[to]);\n\n    const propclassName = React.useMemo(() => {\n        const activable : string | null | Boolean   = props.active;\n\t\tconst baseclassname : string | null \t\t= props.className;\n\n\t\tif (!activable)     return baseclassname? baseclassname:\"\";\n\n        if (current === targetMemo) {\n            return (baseclassname? (baseclassname + \" \"):\"\") + (activable === true ? \"active\":activable);\n        }\n\n        return (baseclassname? (baseclassname + \" \"):\"\");\n    }, [props, current, targetMemo]);\n\n    //----------------------------\n    // Callbacks\n    //----------------------------\n\n    const onClick = React.useCallback((event) => {\n        //Prevent page reload\n        event.preventDefault();\n\n        //Add extra functionality\n        if (\"onClick\" in props) props.onClick(event);\n\n        //Redirect\n        redirect(targetMemo);\n    }, [props, redirect, targetMemo]);\n\n    //----------------------------\n    // Render\n    //----------------------------\n\n    const { active, className, exact, negate, title, ...domprop } = props;\n\n    return (\n        <a {...domprop} onClick={onClick} href=\"#\" className={propclassName}>\n            {props.children}\n        </a>\n    );\n}\n","//Core\nimport * as React \tfrom \"react\";\n\n//Contexts\nimport RouterContext    from \"../contexts/Router\";\n\n//Interfaces\nimport iRouterContext                     from \"../interfaces/contexts\";\nimport { iReactProps, iReactComponent } \tfrom \"../interfaces/iReact\";\nimport { iRoute }                         from \"../interfaces/components\";\n\nexport default function Switch ({...props} : iReactProps) {\n\n    //----------------------------\n    // Properties\n    //----------------------------\n\n    //States\n    const [ ComponentToRender, setcomponent ] = React.useState<any>();\n\n    //Contexts\n    const { processRoute, current, data } = React.useContext(RouterContext) as iRouterContext;\n\n    //----------------------------\n    // Effects\n    //----------------------------\n\n    React.useEffect(() => {\n\t\tconst compchildren = React.Children.toArray(props.children);\n\n\t\t//No children to render\n\t\tif (compchildren.length == 0) return setcomponent(null);\n\n        for (let i = 0; i < compchildren.length; i++) {\n            const child\t\t\t\t\t\t\t            = compchildren[i] as iReactComponent;\n            const {to, children, ...childprops} = child.props as iRoute;\n\n            //Check if child is valid\n            if (!React.isValidElement(child)) continue;\n\n            //Check if route passes\n            const result = processRoute(childprops);\n            if (result) {\n\t\t\t\tconst renderable\t\t\t\t\t= to ? to : (children);\n\t\t\t\tconst newprops \t\t\t\t\t\t= {...childprops, ...(result as Object)};\n\t\t\t\tconst { path, exact, ...restprops } = newprops as {path?:string,exact?:any};\n\n\t\t\t\tif (typeof child.type === \"function\" && child.type.name == \"Route\") {\n\t\t\t\t\t//Is a component\n\t\t\t\t\tif (React.isValidElement(renderable))\n\t\t\t\t\t\treturn setcomponent (React.cloneElement(renderable, {...(renderable.props as Object),...restprops} as React.Attributes));\n\t\t\t\t\t//Is a literal\n\t\t\t\t\telse\n\t\t\t\t\t\treturn setcomponent(React.createElement(renderable, restprops));\n\t\t\t\t}\n\t\t\t\telse {\n\n\t\t\t\t\t//Is a component\n\t\t\t\t\tif (React.isValidElement(child))\n\t\t\t\t\t\treturn setcomponent (React.cloneElement(child, {...(child.props as Object),...restprops} as React.Attributes));\n\t\t\t\t\t//Is a literal\n\t\t\t\t\telse\n\t\t\t\t\t\treturn setcomponent(React.createElement(child, restprops));\n\t\t\t\t}\n            }\n        }\n\n        //No child selected\n        return setcomponent(null);\n    }, [current, data]);\n\n    //----------------------------\n    // Render\n    //----------------------------\n\n    return ComponentToRender ? ComponentToRender:null;\n}\n","// General\nimport * as React \t\tfrom \"react\";\nimport iRouterContext \tfrom \"./interfaces/contexts\";\n\n// Modules components\nimport _Router\t\t\tfrom \"./modules/Router\";\nimport _Route \t\t\tfrom \"./modules/Route\";\nimport _Link \t\t\t  from \"./modules/Link\";\nimport _Switch \t\t\tfrom \"./modules/Switch\";\n\n// Contexts imports\nimport _RouterContext \tfrom \"./contexts/Router\";\n\n// Separated components\nexport const Router \t\t= _Router;\nexport const Route \t\t\t= _Route;\nexport const Link \t\t\t= _Link;\nexport const Switch \t\t= _Switch;\n\n// Contexts\nexport const RouterContext : React.Context<iRouterContext> = _RouterContext;\n\n// Bundled\nconst bundled = {\n\t// Components\n\tRouter: \t_Router,\n\tRoute: \t\t_Route,\n\tLink: \t\t_Link,\n\tSwitch: \t_Switch,\n\n\t// Contexts\n\tRouterContext: _RouterContext,\n};\n\nexport default bundled;\n"],"names":["dumbdata","data","current","basepath","processRoute","redirect","RouterContext","React","buildGuard","guardstring","split","length","name","_arguments","arguments","printGuard","props","response","key","prop","push","guest","router","logged","when","route","testPath","path","exact","negate","splitpath","filter","value","splitcurrent","i","match","replace","optional","context","title","basetitle","subtitle","basetitlestring","Array","isArray","midtitlestring","document","bundle","_guest","_logged","_when","_path","_title","_redirect","Router","guards","sticky","window","location","pathname","setcurrent","defaultBundle","readyguards","history","sethistory","onSetCurrent","newcurrent","base","target","onProcessMimic","_guard","guard","onProcessRoute","clearedProps","prioritydata","onProcessGuard","nonprioritydata","priority","undefined","_guards","console","warn","handleHash","event","preventDefault","onProcessBack","_history","pop","addEventListener","removeEventListener","pushState","processGuard","mimic","back","Provider","children","Route","to","Component","Link","targetMemo","propclassName","activable","active","baseclassname","className","onClick","domprop","href","Switch","ComponentToRender","setcomponent","compchildren","toArray","child","childprops","result","renderable","newprops","restprops","type","_Router","_Route","_Link","_Switch","_RouterContext","bundled"],"mappings":"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"}